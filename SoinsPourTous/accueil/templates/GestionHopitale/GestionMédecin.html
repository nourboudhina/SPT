{% extends "Accueil/baseA.html" %}
{% load static %}
{% block title %} Médecin {% endblock title%}
{% block content %}
<head>
    <!-- Sweet Alert css-->
    <link href="{% static 'assets/libs/sweetalert2/sweetalert2.min.css'%}" rel="stylesheet" type="text/css" />

    <!-- Layout config Js -->
    <script src="{% static 'assets/js/layout.js'%}"></script>
    <!-- Bootstrap Css -->
    <link href="{% static 'assets/css/bootstrap.min.css'%}" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{% static 'assets/css/icons.min.css'%}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{% static 'assets/css/app.min.css'%}" rel="stylesheet" type="text/css" />
    <!-- custom Css-->
    <link href="{% static 'assets/css/custom.min.css'%}" rel="stylesheet" type="text/css" />


</head>
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0">Gestion des Médecins</h4>

                    </div>
                </div>
            </div>
            <!-- end page title -->

            
               

            <div class="row">
                <div class="col-lg-12">
                    <div class="card" id="ticketsList">
                        <div class="card-header border-0">
                            <div class="d-flex align-items-center">
                                <h5 class="card-title mb-0 flex-grow-1">Médecins</h5>
                                <div class="flex-shrink-0">
                                    <button class="btn btn-danger add-btn" data-bs-toggle="modal" data-bs-target="#Ajouter"><i class="ri-add-line align-bottom me-1"></i> Ajouter</button>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="card-body border border-dashed border-end-0 border-start-0">
                            <form>
                                <div class="row g-3">
                                    <div class="col-xxl-5 col-sm-12">
                                        <div class="search-box">
                                            <input type="text" class="form-control search bg-light border-light" placeholder="Chercher un médecin...">
                                            <i class="ri-search-line search-icon"></i>
                                        </div>
                                    </div>
                                    <!--end col-->

                                    

                                </div>
                                <!--end row-->
                            </form>
                        </div>
                        <!--end card-body-->
                        <div class="card-body">
                            <div class="table-responsive table-card mb-4">
                                <table class="table align-middle table-nowrap mb-0" id="ticket-list">
                                    <thead>
                                        <tr>
                                            <th scope="col" style="width: 40px;">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="checkAll" value="option">
                                                </div>
                                            </th>
                                            <th class="sort" data-sort="id">ID</th>
                                            <th class="sort" data-sort="tasks_name">Username</th>
                                            <th class="sort" data-sort="client_name">Mot de passe </th>
                                            <th class="sort" data-sort="client_name">Grade</th>
                                            <th class="sort" data-sort="assignedto">Groupe</th>
                                            <th class="sort" data-sort="assignedto">Service</th>
                                            <th class="sort" data-sort="assignedto">Spécialité</th>
                                            <th class="sort" data-sort="create_date">Date Creation</th>
                                            <th class="sort" data-sort="status">Status</th>
                                         
                                        </tr>
                                    </thead>
                                    <tbody class="list form-check-all" id="ticket-list-data">
                                        <tr>
                                            <th scope="row">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="checkAll" value="option1">
                                                </div>
                                            </th>
                                            <!-- affichage de contenu -->
                                            <td>
                                                <div class="dropdown">
                                                    <button class="btn btn-soft-secondary btn-sm dropdown" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="ri-more-fill align-middle"></i>
                                                    </button>
                                                    <ul class="dropdown-menu dropdown-menu-end">
                                                        <li><a class="dropdown-item edit-item-btn" href="#Modifier" data-bs-toggle="modal"><i class="ri-pencil-fill align-bottom me-2 text-muted"></i> Modifier</a></li> 
                                                        <li>
                                                            <a class="dropdown-item remove-item-btn" data-bs-toggle="modal" href="#delete">
                                                                <button class="btn btn-danger" onclick="deleteDoctor('${doc.id}')">Supprimer</button>

                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="noresult" style="display: none">
                                    <div class="text-center">
                                        <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#121331,secondary:#08a88a" style="width:75px;height:75px">
                                        </lord-icon>
                                        <h5 class="mt-2">Désolé! Aucun résultat trouvé</h5>
                                        <p class="text-muted mb-0">Nous avons cherché et nous n'avons pas trouvé ce Médecin pour vous recherche.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end mt-2">
                                <div class="pagination-wrap hstack gap-2">
                                    <a class="page-item pagination-prev disabled" href="#">
                                        Précédent
                                    </a>
                                    <ul class="pagination listjs-pagination mb-0"></ul>
                                    <a class="page-item pagination-next" href="#">
                                        Suivant
                                    </a>
                                </div>
                            </div>

                            <!-- Modal -->
                            <div class="modal fade" id="Modifier" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <!-- Modal content -->
                            </div>
                            

                            <div class="modal fade flip" id="delete" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-body p-5 text-center">
                                            <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px">
                                            </lord-icon>
                                            <div class="mt-4 text-center">
                                                <h4>Vous êtes sur le point de supprimer un médecin?</h4>
                                                <p class="text-muted fs-14 mb-4">La suppression de ce médecin supprimera toutes ses informations de notre base de données.</p>
                                                <div class="hstack gap-2 justify-content-center remove">
                                                    <button class="btn btn-link link-success fw-medium text-decoration-none" id="deleteRecord-close" data-bs-dismiss="modal"><i class="ri-close-line me-1 align-middle"></i>
                                                        Fermer</button>
                                                    <button class="btn btn-danger" id="delete-record">Oui, Supprimer</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Pour supprimer médecin
                                     api de delete
                                    path('delete_medecin/<token>/<id>/', delete_medecin, name='delete_medecin'), -->
                                </div>
                            </div>
                            <!--end modal -->
                        </div>
                        <!--end card-body-->
                    </div>
                    <!--end card-->
                </div>
                <!--end col-->
            </div>

            <!--end row-->
            <div class="modal fade zoomIn" id="edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content border-0">
                        <div class="modal-header p-3 bg-soft-info">
                            <h5 class="modal-title" id="exampleModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                        </div>
                        <form>
                            <div class="modal-body">
                                <div class="row g-3">
                                    <div class="col-lg-12">
                                        <div id="modal-id">
                                            <label for="orderId" class="form-label">ID</label>
                                            <input type="text" id="orderId" class="form-control" placeholder="ID" value="#VLZ462" readonly />
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">Username</label>
                                            <input type="text" id="tasksTitle-field" class="form-control" placeholder="username" required />
                                        </div>
                                    </div>
                                    
                                   
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Grade</label>
                                            <select class="form-control" data-plugin="choices" name="grade" id="grade-select1">
                                                <option value="">Grade</option>
                                                <!-- Dynamically filled -->
                                            </select>
                                        </div>
                                    </div>
            
                                
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Groupe</label>
                                            <select class="form-control" data-plugin="choices" name="groupe" id="groupe-select1">
                                                <option value="">Groupe</option>
                                                <!-- Dynamically filled -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Service</label>
                                            <select class="form-control" data-plugin="choices" name="ticket-status" id="service1">
                                                <option value="">Services</option>
                                                <!--les options des services présent dans l'hopitele de l'agent -->
                                                
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Spécialité</label>
                                            <select class="form-control" data-plugin="choices" name="ticket-status" id="specialiter1">
                                                <option value="">Spécialités</option>
                                                <!--les options des spécilités présent dans l'hopitele de l'agent -->
                                                
                                            </select>
                                        </div>
                                    </div>
                                  
                                   
                                    
                                  
                                </div>

                            </div>
                            <div class="modal-footer">
                                <div class="hstack gap-2 justify-content-end">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Fermer</button>
                                 
                                    <button type="button" class="btn btn-success" id="edit-btn">Modifier</button>
                                </div>
                            </div>
                        </form>
                        <!-- Pour  modifier  un médecin
                        un api de update 
                        path('modify_medecin/<int:token>/', modify_medecin, name='modify_medecin'), -->
                    </div>
                </div>
            </div>

            <div class="modal fade zoomIn" id="Ajouter" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content border-0">
                        <div class="modal-header p-3 bg-soft-info">
                            <h5 class="modal-title" id="exampleModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                        </div>
                        <form>
                            <div class="modal-body">
                                <div class="row g-3">
                                    <div class="col-lg-12">
                                        <div id="modal-id">
                                            <label for="orderId" class="form-label">ID</label>
                                            <input type="text" id="orderId" class="form-control" placeholder="ID" value="#VLZ462"  />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">email</label>
                                            <input type="text" id="email" class="form-control" placeholder="username" required />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">phone</label>
                                            <input type="text" id="phone" class="form-control" placeholder="phone" required />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">Username</label>
                                            <input type="text" id="username" class="form-control" placeholder="username" required />
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">fullname</label>
                                            <input type="text" id="full_name" class="form-control" placeholder="Full Name" required />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="client_nameName-field" class="form-label">Mot de passe</label>
                                            <input type="password" id="client_nameName-field" class="form-control" placeholder="Mot de passe" required />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Grade</label>
                                            <select class="form-control" data-plugin="choices" name="grade" id="grade-select2">
                                                <option value="">Grade</option>
                                                <!-- Dynamically filled -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="skillsInput" class="form-label">Gouvernement</label>
                                        <select  id='gouv' class="form-control" name="skillsInput" value="trtet">
                                            
                                            <!--les options des gouvernerat présent dans la BD -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <select id="nationalite-select" class="form-control">
                                            <option value="">Select Nationality</option>
                                            <!-- Options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Groupe</label>
                                            <select class="form-control" data-plugin="choices" name="groupe" id="groupe-select2">
                                                <option value="">Groupe</option>
                                                <!-- Dynamically filled -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Service</label>
                                            <select class="form-control" data-plugin="choices" name="ticket-status" id="service2">
                                                <option value="">Services</option>
                                                <!--les options des services présent dans l'hopitele de l'agent -->
                                                
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <label for="assignedtoName-field" class="form-label">Spécialité</label>
                                            <select class="form-control" data-plugin="choices" name="ticket-status" id="specialiter2">
                                                <option value="">Spécialités</option>
                                                <!--les options des spécilités présent dans l'hopitele de l'agent -->
                                                
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="date-field" class="form-label">Date Creation </label>
                                        <input type="text" id="date-field" class="form-control" data-provider="flatpickr" data-date-format="d M, Y" placeholder="Create Date" required />
                                    </div>
                                    <div class="col-lg-12">
                                        <div>
                                            <label for="tasksTitle-field" class="form-label">addresse</label>
                                            <input type="text" id="addresse" class="form-control" placeholder="username" required />
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-6">
                                        <label for="ticket-status" class="form-label">État</label>
                                        <select class="form-control" data-plugin="choices" name="ticket-status" id="ticket-status">
                                            <option value="">État</option>
                                            <option value="New">Nouveau</option>
                                            <option value="Inprogress">Inprogrès</option>
                                            
                                        </select>
                                    </div>
                                    
                                </div>

                            </div>
                            <div class="modal-footer">
                                <div class="hstack gap-2 justify-content-end">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Fermer</button>
                                    <button type="submit" class="btn btn-success" id="add-btn">Ajouter</button>
                                    <button type="button" class="btn btn-success" id="edit-btn">Modifier</button>
                                </div>
                            </div>
                        </form>
                        <!-- Pour  modifier  un médecin
                        un api de update 
                        path('modify_medecin/<int:token>/', modify_medecin, name='modify_medecin'), -->
                    </div>
                </div>
            </div>
        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->


    <!-- JAVASCRIPT -->
    <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js'%}"></script>
    <script src="{% static 'assets/libs/simplebar/simplebar.min.js'%}"></script>
    <script src="{% static 'assets/libs/node-waves/waves.min.js'%}"></script>
    <script src="{% static 'assets/libs/feather-icons/feather.min.js'%}"></script>
    <script src="{% static 'assets/js/pages/plugins/lord-icon-2.1.0.js'%}"></script>
    <script src="{% static 'assets/js/plugins.js'%}"></script>

    <!-- list.js min js -->
    <script src="{% static 'assets/libs/list.js/list.min.js'%}"></script>

    <!--list pagination js-->
    <script src="{% static 'assets/libs/list.pagination.js/list.pagination.min.js'%}"></script>

    <!-- titcket init js -->
    <script src="{% static 'assets/js/pages/ticketlist.init.js'%}"></script>

    <!-- Sweet Alerts js -->
    <script src="{% static 'assets/libs/sweetalert2/sweetalert2.min.js'%}"></script>

    <!-- App js -->
    <script src="{% static 'assets/js/app.js'%}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrl = '/gouvernorats/';  // Adjust if necessary to match the exact API route
        
            fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not OK');
                }
                return response.json();
            })
            .then(data => {
                const select = document.getElementById('gouv');
                // Clear existing options
               
                data.forEach(gov => {
                    const option = new Option(gov.name, gov.id);
                    // Create new option element
                    select.appendChild(option);  // Append option to select
                });
        
                // Reinitialize Choices.js if used
                if (window.Choices) {
                    new Choices(select, {
                        removeItemButton: true,  // Configurable options
                    });
                }
            })
            .catch(error => {
                console.error('Failed to fetch data:', error);
            });
        });
        </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch and populate Grades
            const fetchGrades = () => {
                fetch('/grades/')
                    .then(response => response.json())
                    .then(data => {
                        const gradeSelects = [document.getElementById('grade-select1'), document.getElementById('grade-select2')];
                        gradeSelects.forEach(select => {
                            select.innerHTML = '<option value="">Grade</option>'; // Clear and add placeholder
                            data.forEach(grade => {
                                let option = new Option(grade.grade, grade.id);
                                select.appendChild(option);
                            });
                        });
                    })
                    .catch(error => console.error('Error loading grades:', error));
            };
        
            // Fetch and populate Groupes
            const fetchGroupes = () => {
                fetch('/groupes/')
                    .then(response => response.json())
                    .then(data => {
                        const groupeSelects = [document.getElementById('groupe-select1'), document.getElementById('groupe-select2')];
                        groupeSelects.forEach(select => {
                            select.innerHTML = '<option value="">Groupe</option>'; // Clear and add placeholder
                            data.forEach(groupe => {
                               
                                let option = new Option(groupe.groupe, groupe.id);
                                select.appendChild(option);
                            });
                        });
                    })
                    .catch(error => console.error('Error loading groupes:', error));
            };
        
            // Fetch and populate Services
            const fetchServices = () => {
                fetch('/services/')
                    .then(response => response.json())
                    .then(data => {
                        const serviceSelects = [document.getElementById('service1'), document.getElementById('service2')];
                        serviceSelects.forEach(select => {
                            select.innerHTML = '<option value="">Service</option>'; // Clear and add placeholder
                            data.forEach(service => {
                                let option = new Option(service.service, service.id);
                                select.appendChild(option);
                            });
                        });
                    })
                    .catch(error => console.error('Error fetching services:', error));
            };
        
            // Fetch and populate Spécialités
            const fetchSpecialites = () => {
                fetch('/specialites/')
                    .then(response => response.json())
                    .then(data => {
                        const specialiteSelects = [document.getElementById('specialiter1'), document.getElementById('specialiter2')];
                        specialiteSelects.forEach(select => {
                            select.innerHTML = '<option value="">Spécialité</option>'; // Clear and add placeholder
                            data.forEach(specialite => {
                                let option = new Option(specialite.specialite, specialite.id);
                                select.appendChild(option);
                            });
                        });
                    })
                    .catch(error => console.error('Error loading spécialités:', error));
            };
        
            // Initial fetch calls
            fetchGrades();
            fetchGroupes();
            fetchServices();
            fetchSpecialites();
        });
        </script>
        
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Fetch and display doctors
                const fetchDoctors = () => {
                    fetch('/medecins/')
                        .then(response => response.json())
                        .then(data => {
                            const tableBody = document.getElementById('ticket-list-data');
                            tableBody.innerHTML = '';  // Clear the table
                            data.forEach(doc => {
                                const row = `<tr>
                                    <td><input type="checkbox" value="${doc.id}"></td>
                                    <td class="id">${doc.id}</td>
                                    <td class="username">${doc.username}</td>
                                        <td class="password">${doc.password}</td>
                                        <td class="grade">${doc.grade_name}</td>
                                        <td class="group">${doc.groupe_name}</td>
                                        <td class="service">${doc.service_name}</td>
                                        <td class="specialty">${doc.specialite_name}</td>
                                        <td class="birthdate">${doc.date_nais}</td>
                                        <td class="status">${doc.status}</td>
                                    <td>
                                        <button onclick="deleteDoctor('${doc.id}')" class="btn btn-danger">Supprimer</button>
                                        <button onclick="handleButtonClick(this)" class="btn btn-primary edit-btn" data-doctor-id="${doc.id}" data-bs-toggle="modal" data-bs-target="#edit">Edit</button>
                                    </td>
                                </tr>`;
                                tableBody.innerHTML += row;
                            });
                        })
                        .catch(error => console.error('Error loading doctors:', error));
                };
            
                // Add a new doctor
                const addDoctor = () => {
                    
                    const id= document.getElementById('orderId').value;
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('client_nameName-field').value;
                    const gradeId = document.getElementById('grade-select2').value;
                    const groupeId = document.getElementById('groupe-select2').value;
                    const serviceId = document.getElementById('service2').value;
                    const specialiteId = document.getElementById('specialiter2').value;
                    const datnes = document.getElementById('date-field').value;
                    const Addresse = document.getElementById('addresse').value;
                    const Email = document.getElementById('email').value;
                    const Fullname = document.getElementById('full_name').value;
                    const Phone = document.getElementById('phone').value;
                    const Gouvernerat = document.getElementById('gouv').value;
                    const nationaliteSelect = document.getElementById('nationalite-select').value;
                    const pathArray = window.location.pathname.split('/');
                    const tokenA = pathArray[pathArray.length - 2];
                    alert(username)
                    const data = {
                        id:id,
                        username:username,
                        password:password,
                        grade: gradeId,
                        groupe: groupeId,
                        service: serviceId,
                        specialite: specialiteId,
                        date:datnes ,
                        addresse:Addresse,
                        email:Email,
                        fullname:Fullname,
                        phone:Phone,
                        gouvernerat:Gouvernerat,
                        token:tokenA,
                        nationalite:nationaliteSelect,
                    };
            
                    fetch('/medecins/add/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        fetchDoctors(); // Reload the list
                        $('#Modifier').modal('hide'); // Hide the modal after save
                    })
                    .catch(error => console.error('Failed to add doctor:', error));
                };
            
                // Delete a doctor
                const deleteDoctor = (id) => {
                    fetch(`/medecins/delete/${id}/`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        console.log('Doctor deleted');
                        fetchDoctors(); // Reload the list
                    })
                    .catch(error => console.error('Failed to delete doctor:', error));
                };
            
                // Event listener for the add button
                document.getElementById('add-btn').addEventListener('click', addDoctor);
            
                // Initial fetch calls
                fetchDoctors();
            });
            document.addEventListener('DOMContentLoaded', function() {
            const nationaliteSelect = document.getElementById('nationalite-select');
              
    fetch('/nationalites/')
        .then(response => response.json())
        .then(data => {
            data.forEach(item => {
                const option = new Option(item.nationalite, item.id);
                nationaliteSelect.appendChild(option);
            });
        })
        .catch(error => console.error('Error loading nationalities:', error));
});
function deleteDoctor(doctorId) {
    const url = `/medecins/delete/${doctorId}/`;  // URL to send the delete request
    fetch(url, {
        method: 'DELETE',  // Use the DELETE HTTP method
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),  // CSRF token for security, assuming you're using Django's CSRF protection
        }
    })
    .then(response => {
        if (response.ok) {
            console.log('Doctor deleted successfully');
            window.location.reload();  // Reload the page to update the list of doctors
        } else {
            throw new Error('Failed to delete doctor');
        }
    })
    .catch(error => {
        console.error('Error deleting doctor:', error);
        alert('Failed to delete doctor: ' + error.message);  // Show error message if something goes wrong
    });
}
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
    // Function to fetch and display a single doctor's details for editing


}


            </script>
<script>
 function handleButtonClick(button) {
    const row = button.closest('tr'); 
    const id = row.querySelector('.id').textContent;
    const username = row.querySelector('.username').textContent;
    const pathArray = window.location.pathname.split('/');
    const tokenA = pathArray[pathArray.length - 2];
  

    document.getElementById('orderId').value = id;
    document.getElementById('tasksTitle-field').value = username;

    $('#editModal').modal('show');}
</script>
                
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('edit-btn').addEventListener('click', function() {
            const id = document.getElementById('orderId').value;
            const username = document.getElementById('tasksTitle-field').value;
            const gradeId = document.getElementById('grade-select1').value;
            const groupeId = document.getElementById('groupe-select1').value;
            const serviceId = document.getElementById('service1').value;
            const specialiteId = document.getElementById('specialiter1').value;
            const pathArray = window.location.pathname.split('/');
            const tokenA = pathArray[pathArray.length - 2];
  
            // Create a data object to send to the server
            const data = {
                id: id,
                username: username,
                grade: gradeId,
                groupe: groupeId,
                service: serviceId,
                specialite: specialiteId
            };

            // API endpoint for updating a doctor
            const updateUrl = `/accueil/modify_medecin/${tokenA}/`; // Ensure you have the correct URL and token

            // Send the request to the server
            fetch(updateUrl, {
                method: 'POST', // or 'PUT' if your API requires
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                $('#edit').modal('hide'); // Close modal on success
                location.reload(); // Optional: reload the page to see the changes
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    });
</script>
           
{% endblock content %}